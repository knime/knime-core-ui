/*
 * ------------------------------------------------------------------------
 *
 *  Copyright by KNIME AG, Zurich, Switzerland
 *  Website: http://www.knime.com; Email: contact@knime.com
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License, Version 3, as
 *  published by the Free Software Foundation.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, see <http://www.gnu.org/licenses>.
 *
 *  Additional permission under GNU GPL version 3 section 7:
 *
 *  KNIME interoperates with ECLIPSE solely via ECLIPSE's plug-in APIs.
 *  Hence, KNIME and ECLIPSE are both independent programs and are not
 *  derived from each other. Should, however, the interpretation of the
 *  GNU GPL Version 3 ("License") under any applicable laws result in
 *  KNIME and ECLIPSE being a combined program, KNIME AG herewith grants
 *  you the additional permission to use and propagate KNIME together with
 *  ECLIPSE with only the license terms in place for ECLIPSE applying to
 *  ECLIPSE and the GNU GPL Version 3 applying for KNIME, provided the
 *  license terms of ECLIPSE themselves allow for the respective use and
 *  propagation of ECLIPSE together with KNIME.
 *
 *  Additional permission relating to nodes for KNIME that extend the Node
 *  Extension (and in particular that are based on subclasses of NodeModel,
 *  NodeDialog, and NodeView) and that only interoperate with KNIME through
 *  standard APIs ("Nodes"):
 *  Nodes are deemed to be separate and independent programs and to not be
 *  covered works.  Notwithstanding anything to the contrary in the
 *  License, the License does not apply to Nodes, you are not required to
 *  license Nodes under the License, and you are granted a license to
 *  prepare and propagate Nodes, in each case even if such Nodes are
 *  propagated with or for interoperation with KNIME.  The owner of a Node
 *  may freely choose the license terms applicable to such Node, including
 *  when such Node is propagated with or for interoperation with KNIME.
 * ---------------------------------------------------------------------
 *
 * History
 *   Jul 14, 2022 (hornm): created
 */
package org.knime.core.webui.node.view.table.data.render;

import java.awt.Component;
import java.awt.Dimension;
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.util.Optional;

import javax.imageio.ImageIO;

import org.knime.core.data.DataColumnSpec;
import org.knime.core.data.DataType;
import org.knime.core.data.DataValue;
import org.knime.core.data.property.ValueFormatHandler;
import org.knime.core.data.renderer.AbstractPainterDataValueRenderer;
import org.knime.core.data.renderer.DefaultDataValueRenderer;
import org.knime.core.data.renderer.ImageValueRenderer;
import org.knime.core.data.renderer.MultiLineStringValueRenderer;
import org.knime.core.node.NodeLogger;
import org.knime.core.webui.node.view.table.data.TableViewDataServiceImpl;

/**
 * A renderer factory that uses and returns the swing-based
 * {@link org.knime.core.data.renderer.DataValueRenderer}-implementations.
 *
 * @author Martin Horn, KNIME GmbH, Konstanz, Germany
 */
public final class SwingBasedRendererFactory implements DataValueRendererFactory {

    @Override
    public DataValueRenderer createDataValueRenderer(final DataColumnSpec colSpec, final String rendererId) {
        // use swing-based legacy renderers as fallback
        var dataType = colSpec.getType();
        if (rendererId == null) {
            // create default renderer

            // use formatter attached to the column if present
            Optional<DataValueRenderer> formatHandler = Optional.ofNullable(colSpec.getValueFormatHandler())//
                .map(SwingBasedRendererFactory::createHtmlRenderer);
            if (formatHandler.isPresent()) {
                return formatHandler.get();
            }

            // use swing-based legacy renderers as fallback
            var it = dataType.getRendererFactories().iterator();
            return createRenderer(it.next(), colSpec);
        } else {
            return dataType.getRendererFactories().stream()//
                .filter(f -> f.getId().equals(rendererId)) //
                .map(f -> createRenderer(f, colSpec))//
                .findFirst().orElseGet(() -> {
                    NodeLogger.getLogger(getClass())
                        .warn("No renderer found for id " + rendererId + ". Falling back to default renderer.");
                    return createDataValueRenderer(colSpec, null);
                });
        }
    }

    @Override
    public String[] getDataValueRendererIds(final DataType dataType) {
        return dataType.getRendererFactories().stream()
            .map(org.knime.core.data.renderer.DataValueRendererFactory::getId).toArray(String[]::new);
    }

    private static DataValueRenderer createRenderer(
        final org.knime.core.data.renderer.DataValueRendererFactory rendererFactory, final DataColumnSpec colSpec) {
        var renderer = rendererFactory.createRenderer(colSpec);
        var id = rendererFactory.getId();
        if (renderer instanceof AbstractPainterDataValueRenderer) {
            return new SwingBasedImageRenderer((AbstractPainterDataValueRenderer)renderer, id);
        } else if (renderer instanceof DefaultDataValueRenderer) {
            var defaultRenderer = (DefaultDataValueRenderer)renderer;
            if (defaultRenderer.getIcon() != null) {
                return new SwingBasedImageRenderer(defaultRenderer, id);
            } else {
                return new SwingBasedTextRenderer(defaultRenderer);
            }
        } else if (renderer instanceof ImageValueRenderer) {
            return new SwingBasedImageRenderer((ImageValueRenderer)renderer, id);
        } else {
            throw new UnsupportedOperationException(
                "The renderer of type '" + renderer.getClass().getName() + "' is currently not supported.");
        }
    }

    static class SwingBasedTextRenderer implements DataValueTextRenderer {

        private final DefaultDataValueRenderer m_renderer;

        SwingBasedTextRenderer(final DefaultDataValueRenderer renderer) {
            m_renderer = renderer;
        }

        @Override
        public String renderText(final DataValue value) {
            m_renderer.setValueCatchingException(value);
            return m_renderer.getText();
        }

        @Override
        public DataCellContentType getContentType() {
            if (m_renderer instanceof MultiLineStringValueRenderer) {
                return DataCellContentType.MULTI_LINE_TXT;
            }
            if (m_renderer instanceof DataValueRenderer dvr) {
                return dvr.getContentType();
            }
            return DataValueTextRenderer.super.getContentType();
        }

    }

    static class SwingBasedImageRenderer implements DataValueImageRenderer {

        private final org.knime.core.data.renderer.DataValueRenderer m_renderer;

        private final String m_id;

        SwingBasedImageRenderer(final AbstractPainterDataValueRenderer swingBasedPainterRenderer, final String id) {
            m_renderer = swingBasedPainterRenderer;
            m_id = id;
        }

        SwingBasedImageRenderer(final DefaultDataValueRenderer swingBasedDefaultRenderer, final String id) {
            m_renderer = swingBasedDefaultRenderer;
            m_id = id;
        }

        SwingBasedImageRenderer(final ImageValueRenderer swingBasedImageValueRenderer, final String id) {
            m_renderer = swingBasedImageValueRenderer;
            m_id = id;
        }

        @Override
        public byte[] renderImage(final DataValue value, final int width, final int height) {
            if (true) {
                return IMG;
            }

            // NOTE: mostly copied from Renderer2ImageNodeModel#createPngCell
            var comp = getRendererComponent(value, m_renderer);
            var size = new Dimension(width, height);
            if (comp instanceof AbstractPainterDataValueRenderer apdvr) {
                size = apdvr.getPreferredSize(size);
            }
            comp.setSize(size);
            var image = new BufferedImage(size.width, size.height, BufferedImage.TYPE_INT_ARGB);
            // create graphics object to paint in
            Graphics2D graphics = image.createGraphics();
            comp.paint(graphics);
            try (var bos = new ByteArrayOutputStream(4096)) {
                ImageIO.write(image, "png", bos);
                return bos.toByteArray();
            } catch (IOException e) {
                // should never happen
                NodeLogger.getLogger(TableViewDataServiceImpl.class)
                    .error("Problem rendering data cell into a png image", e);
                return new byte[0];
            }
        }


        private static final byte[] IMG = new byte[]{-119, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0,
            0, 0, 53, 0, 0, 0, 79, 8, 6, 0, 0, 0, 75, 95, -115, -41, 0, 0, 28, -128, 73, 68, 65, 84, 120, 94, -43, -37,
            121, 84, -108, 103, -126, -17, 113, 59, -23, -71, -23, 108, -90, -37, 24, -115, 123, 92, 3, -126, -20, -85,
            -88, 81, 64, 81, 80, 4, 20, 100, 17, -39, 85, -36, -9, 5, -107, -88, -56, -114, 44, 5, 20, 84, -79, 47, -78,
            -17, 32, 32, -85, -128, -78, 21, 5, -59, -114, 40, 8, -120, -58, -114, 51, 109, -70, 111, 79, -18, -100,
            -103, 51, -9, 119, -97, -9, 41, -86, 40, -88, 66, 49, -35, -13, -57, -51, 57, -33, 67, -127, -55, 57, -17,
            39, -49, -14, 62, -17, 75, 50, -89, -39, 49, 1, -62, -30, -48, -26, -56, -123, -64, 53, 30, 2, 55, -114,
            -72, -74, -61, -47, -76, -10, 83, -15, 104, 59, 29, -113, 90, -25, 48, 100, 57, -122, 33, -33, -115, -115,
            -20, 35, 108, -72, -103, 7, 67, 127, 127, 23, -76, -83, -34, 74, -91, 101, -3, 22, -102, 54, 19, 89, -1, 44,
            -99, -24, -49, 100, -76, -15, -48, -33, -79, -29, -64, 27, 108, -77, 120, -123, -19, -26, -49, 81, -55, 26,
            70, 103, 110, 31, -98, -28, 118, -94, 39, -93, 13, 29, 41, 77, -76, 34, -97, 44, 36, 95, -30, -118, -101,
            -61, -4, 53, 29, 69, 97, 50, 80, 45, -18, 28, 52, 29, -29, -96, -40, -54, -101, -126, 68, -59, 29, 45, -128,
            -75, 105, -81, 20, -24, -97, -123, 98, 50, -74, 26, 71, -98, 119, 39, -22, 19, -102, -47, -97, -35, -127,
            -63, -68, 46, 12, 21, -10, 98, 32, 71, 64, -65, 74, 54, 43, 20, -33, 45, -102, 38, -119, 42, 112, -117, 34,
            -79, 81, -28, -54, 70, -114, 99, 1, 118, 42, 85, 78, -59, 88, -3, 66, -45, -76, -2, 69, 2, -11, -26, -125,
            81, -122, -42, -1, 74, 34, -88, 3, 47, 81, 16, -48, -113, -74, -116, 14, -12, 103, 9, 48, -104, -37, -115,
            -95, -126, 62, 10, -108, -119, -86, -73, -27, 72, -95, -38, -100, 34, -47, -18, 18, 53, 5, -41, -24, 30,
            -115, -122, 99, -47, -72, -73, -37, 3, 69, 78, 28, -38, 125, -57, 40, -92, -72, 21, 97, -37, -50, 86, -88,
            -20, 125, 13, 117, -117, 55, 20, -91, 126, -32, 87, 97, -42, 127, 37, -67, -91, 77, -65, -24, -39, -92, 99,
            -11, 51, 54, -37, -67, -59, 54, -37, 55, -16, 60, 86, 3, 65, -38, 99, 12, 100, -10, -118, -101, 17, -11,
            -66, -111, -102, -114, -86, 112, 10, -103, -126, -118, -76, -66, 71, 81, -110, 35, 37, 66, 41, -102, -1, 76,
            122, -3, 15, -95, -104, 54, 89, -66, -62, 85, -73, 10, 41, -44, 116, -112, 24, -43, -26, -112, 8, -127, 75,
            42, -39, 32, -110, -47, 110, 31, 67, -101, -70, -90, 34, 105, -68, 83, 113, -56, -74, -72, -119, 7, -114,
            -63, 40, 115, -113, 65, -95, 75, 36, 45, -23, 104, 14, -52, 77, 74, -90, -96, 52, -83, -1, 14, 101, -117,
            -65, 64, -37, -14, -81, 82, -21, 108, -54, -33, 39, 3, 34, -103, -98, -27, -49, -76, 31, -10, -65, -126,
            -33, -71, 90, 12, -92, 11, 71, 71, -76, -90, 70, -13, -6, -91, -6, -1, 7, 101, 57, -126, -38, -12, -65, -30,
            105, -38, -77, -33, -122, -22, 114, 74, -112, 66, 117, 30, -25, -94, -42, -123, -123, 60, 75, 47, -103, 40,
            51, -29, 98, 41, 20, -45, 63, 13, -75, 127, 12, 33, -105, 27, 48, -104, -2, -12, 67, 81, -119, -24, 114,
            -119, -90, 9, 14, -77, -59, -11, 30, -113, -95, 61, 34, -9, -92, 42, -105, 48, -44, 30, -114, 64, 57, -39,
            9, 11, -99, 89, -76, -20, -61, 9, -72, 110, -107, 1, 45, -45, 113, 113, -45, 47, 94, 18, -86, 105, -3, 55,
            -87, -117, -97, 41, 17, 106, 11, -103, 126, -25, 92, 43, -63, 79, -25, 97, 48, -83, 7, 67, -103, -3, 24,
            -55, 25, 20, -81, -93, -25, -7, -77, 68, 117, 29, -115, 22, -125, -104, 4, -25, -109, 81, -23, 28, 42, 70,
            -119, 98, 80, -82, 91, 66, -1, -121, 81, -81, -31, 102, 93, 4, 126, -26, 63, -126, 34, -9, -96, -18, 35, 28,
            -12, 29, -117, 69, 15, 1, 49, -15, -49, 39, -31, -66, 67, 16, -86, -113, 70, -96, -30, 40, 71, 92, -74, 91,
            2, -114, 25, 68, 18, -52, 24, -76, -9, -66, -128, -114, 25, 65, 89, -2, 77, 24, -71, 87, -55, 68, 49, -69,
            -31, 12, 59, -94, -42, -127, -55, 38, -89, -33, 56, 46, 58, -35, 71, 119, 90, 55, -103, -126, 100, -22, 101,
            -11, 97, 36, -9, 9, -122, 11, -70, 105, -49, -13, 123, 48, 58, -47, -116, 40, -90, 30, 55, 46, -6, -113,
            -58, -47, -11, -60, -44, 124, 46, 30, -103, -42, 94, -88, 60, 22, -119, -22, 35, -47, -30, 114, 93, 18, -31,
            -79, 55, 25, 90, 123, 71, -96, 107, -15, -126, 110, -65, -38, -5, 127, 21, 38, -79, -90, 36, 81, -17, 90,
            83, -38, 86, 127, -127, -114, -91, 48, -55, 53, -107, -57, 30, 35, 27, -59, 16, -98, 102, 116, 98, 56, -69,
            -121, -114, -54, 72, 126, -121, 84, -1, 52, -108, -113, 93, 30, 69, -119, -6, -97, 64, -91, -34, 29, 68, 95,
            74, -33, -121, -94, -110, -23, -50, 71, 115, -115, 68, -49, -31, 40, -12, -69, 115, -59, 107, -86, -6, 72,
            4, 114, -20, 124, -90, -96, 42, -114, -78, -111, -27, 22, 67, 96, 85, -72, 114, -14, 53, 52, -12, 59, -95,
            96, -2, -65, -59, 40, 45, -85, 95, -59, -104, -23, 107, -116, 73, 116, -15, 51, -75, -35, -20, 21, 109,
            -113, 89, 47, -10, -84, 60, -117, -14, 99, -113, -47, -101, -62, -61, 104, -63, 0, 58, -30, 27, 49, -108,
            -42, 78, 27, -53, -99, 113, 77, -67, 27, -11, -24, 36, 23, 89, 54, 119, 100, -94, -14, 92, -85, 113, 96,
            119, 19, -74, -19, 125, 62, 5, -91, -74, -17, 111, 80, -35, -1, 11, 109, 58, -120, 73, -125, -100, 56, -76,
            -10, -3, -85, 20, 102, 58, -54, -100, 28, -104, -19, -65, 62, -123, 72, -123, 80, 120, -85, -34, -128, -89,
            -4, 37, 116, 121, -14, -16, 60, -83, 3, -61, -9, -2, 1, -108, -84, -23, 39, -119, -38, -73, -77, 30, 91,
            118, 63, -99, -126, 82, 49, -5, -123, -34, -124, -23, -115, 88, 6, 74, -115, -100, 23, 53, -55, 121, 113,
            58, 102, 58, -54, 114, 119, 47, 78, 125, 122, 2, -23, 43, -126, 17, 39, 31, -113, 36, -59, 36, -60, -53, 39,
            -32, -108, -26, 33, 12, 38, -75, -50, 14, 37, -21, 62, -59, 59, 29, -121, -36, -3, -73, -23, -106, 46, -119,
            -54, 35, -1, 2, -110, 45, 50, 96, -71, -93, 26, -122, -90, 3, -48, -76, -6, -9, 73, -120, 104, 109, 49, 64,
            2, -104, -114, -110, -107, 36, 106, -101, -39, -81, -48, -37, -37, -125, -83, -26, 21, -88, -16, 27, -60,
            -67, -13, -115, -72, -69, 45, 13, 65, -85, 89, -56, 90, 21, 11, -106, 60, 11, 30, 127, -14, -64, -93, -101,
            -43, 24, -49, 30, 36, -21, 77, -16, 110, -44, -12, -5, -44, -69, 80, -39, 118, -123, -16, 56, 62, 10, -125,
            61, -3, 80, 54, 123, 43, 70, -87, -20, 121, 75, 19, -95, 36, -101, -114, -103, 9, -75, -51, 114, 16, 63,
            -40, 61, 68, 96, -22, 16, -126, 82, -122, -112, 30, -7, 19, -78, -81, -11, -61, 67, -111, 5, -10, 6, 54,
            -123, 93, -45, -69, -128, -127, 100, 62, -6, 83, -38, -124, -88, 22, -57, 88, -76, -111, -99, -113, -49,
            -20, 126, -50, 92, 90, 39, -71, 80, -90, 46, 55, -39, 35, 85, -23, -50, 38, -45, -112, -115, 7, -57, 35,
            -59, -88, 80, -113, 49, -24, 27, 118, 64, 99, -9, -81, 80, -35, -5, 111, 52, 21, 115, 2, 35, 72, 21, -13,
            95, -90, -128, -76, -56, 5, -85, -102, -3, 121, 10, 70, 111, -1, 91, 108, -38, -9, 31, -48, -77, -8, 119,
            108, -74, 124, 3, 85, -109, 126, 24, -40, -66, -58, -26, -3, -61, -40, 106, 83, -122, 112, -18, 115, 68, 36,
            -116, 34, 38, 105, 12, 73, -15, 99, 72, -29, -114, -63, 95, 62, 28, -36, 117, -47, -120, 89, 21, -123, -69,
            27, -4, -15, 83, -6, 115, -47, -93, 71, 12, 65, 37, 16, 84, -36, -28, -106, -50, -128, 38, -110, -119, 34,
            -21, -118, -23, -63, -15, 112, 49, -118, -27, -15, 20, 6, 6, 124, 104, 25, -1, 39, -44, 76, -1, -115, -58,
            -96, -60, -93, 54, 109, -108, -90, -113, -42, -90, 125, 127, -63, -90, 3, -49, 96, -76, -81, 23, 86, 22, 69,
            -56, 40, 41, -62, 105, -17, 90, 108, 53, 109, -127, -127, 101, 26, -62, 56, -93, -120, -116, 127, -127, -72,
            -92, 17, 113, 37, 30, 79, -64, -107, -113, 65, -22, -46, 68, -124, -55, -121, 32, -63, 62, 90, 26, -43, -18,
            16, 33, -123, 18, -83, -85, 122, -73, 8, 20, -37, -6, 81, -44, 125, -41, -112, 41, -88, -100, -125, 69, -72,
            100, 95, -117, 61, 100, -6, -67, 11, 53, 125, -86, 73, -90, 101, -6, 18, 26, -42, 105, -16, 10, 34, 79, 10,
            -7, 55, -47, 91, 117, 8, 49, -100, 91, 112, -36, -105, -116, 56, -10, 56, 1, -115, -126, 29, 55, 58, 5,
            -107, 25, -15, 18, -15, -90, -59, 72, 94, -109, -116, -56, 13, -31, 56, -81, 122, 66, 26, 37, -21, 64, 43,
            70, 29, 14, 67, -79, -99, 55, 106, -113, -124, -95, -44, 81, 88, -79, -13, 93, -28, -109, -97, 103, 31, -52,
            65, -116, -53, 48, -84, -116, 94, 64, -39, 4, 98, -108, -52, -10, 10, -97, -114, -23, -108, -101, -72, -71,
            -46, -56, -61, -32, 22, -29, 12, -108, -42, 94, 67, 109, -125, 35, 106, 43, -126, 33, -24, 125, -119, 115,
            23, 51, 17, 20, -44, -121, -24, -72, 33, 90, 108, -14, 51, 113, 9, 100, 42, -106, 69, -114, -127, -91, -109,
            4, -114, 106, 34, 66, 21, 34, 102, -121, 98, 64, -52, -41, -9, -95, -14, 60, -6, 112, -58, -19, 5, 89, 43,
            50, 32, -77, 64, 25, -104, -107, -31, -26, -115, 0, 52, 85, -33, -127, -96, 61, 14, -81, 7, -58, 49, 60,
            -10, 127, 16, -55, 105, 5, -101, 61, 34, 70, 69, -57, 15, -120, -117, -119, 27, 70, 81, 40, -127, -22, 103,
            34, -53, -80, 16, -79, 26, -15, -65, 5, -27, 35, -123, 42, 56, -52, 34, -45, 47, 11, -7, -98, -113, 112,
            -58, -67, 29, -86, -5, 6, -92, 33, 18, -87, 18, -108, -106, 21, -77, -53, -3, 66, 48, 111, 38, 80, 111, 112,
            -3, 66, 26, 122, 27, -82, -93, -87, -32, 18, -58, -97, -10, -31, 85, -41, 127, 99, 120, -12, 63, 9, -86,
            -123, -96, -98, -49, -120, 42, 8, 27, 66, -47, 105, 62, 110, -53, -123, 33, 65, 73, -116, 74, 32, -88, 20,
            -126, 74, 16, -81, 41, 73, 20, 115, 90, 103, -86, 118, 10, 69, -119, -99, 63, -54, -99, -126, -23, -102,
            -94, -71, -124, -93, -56, 41, 22, 37, 46, -15, 100, -47, 14, -63, 122, 39, 15, 26, -90, 111, -91, 32, 76,
            -94, -47, -47, -80, -2, 11, -44, -20, -56, -10, 111, 34, -64, 22, -93, 58, 108, -34, 83, 7, 35, -85, 22,
            100, -36, 61, -118, -89, -115, -18, 40, -53, -13, -64, -77, 17, -14, 120, -15, -12, -17, -24, -20, -6, 47,
            68, 115, 121, -120, -116, 105, -105, -119, 18, -107, -32, -33, -125, -117, 42, 33, 72, 89, 43, -34, 40, -90,
            -94, -104, 126, 11, 42, -1, -30, 0, -10, -23, 55, -66, 19, -59, 108, 22, 106, -90, 63, -111, -87, 86, -118,
            -13, 39, -81, -96, -79, 50, 4, 77, 85, 94, -72, 120, 92, 21, 109, 15, -11, -64, -85, -41, -60, 80, 79, 44,
            6, -98, 118, -32, -25, -41, -1, -115, 29, 70, 23, 16, 69, -90, 95, 100, 76, -57, 59, 81, 41, 65, 3, 83, 81,
            -94, 87, 100, 45, 100, 26, -54, 66, -119, 106, 58, 19, -121, 98, -89, -69, -109, 32, 9, -44, -125, -93, 41,
            -88, -72, -2, 12, -106, -37, -22, -96, -67, -101, 89, 55, -81, 39, 122, 35, 70, 49, -69, 27, -109, -114,
            -23, 8, 118, 24, -6, -96, -73, -20, 34, -98, -107, 107, -32, 121, -93, 10, 94, -14, -76, 48, -34, -91, -125,
            39, 77, -54, 24, -21, 58, -123, 55, 79, -117, -47, 82, -54, 70, -64, -11, 115, 8, -11, 37, 27, -59, 93, 1,
            -71, -8, 39, -62, 68, 56, 9, 96, 50, 103, 8, -127, -106, 89, -32, 40, -124, 127, 32, -22, 108, 28, 93, 67,
            51, -95, -102, 47, 53, -62, -57, -98, -113, -99, 59, 7, 102, 64, 9, -97, -118, -123, 40, 47, 12, -108, -98,
            -63, 112, -71, 26, 65, 41, -29, 101, -101, 38, 94, 118, 110, -60, 32, -7, -36, -43, -92, -118, -90, 70, 37,
            -12, -9, 108, -62, 72, -121, 1, 90, 31, -35, -127, 119, 72, -54, -28, -56, -56, 64, 37, 113, -98, 33, -64,
            42, 19, -47, -28, -108, -15, 65, -88, 18, -5, 0, 20, 56, 4, -56, 68, 21, 56, 112, 49, 124, 46, 23, 53, -41,
            -6, -32, -76, -93, -2, -67, -88, 93, 70, -34, -88, 75, -80, -63, 120, -115, -50, 20, 20, -45, 104, -113, 14,
            -98, 14, -88, -30, 105, -65, 6, 70, -5, -41, -126, -49, 59, -127, -80, -72, -16, 119, -94, -78, 83, -55,
            -47, -23, 74, -21, -69, 81, -45, 111, -66, -76, 11, 9, -88, 116, -71, -117, 7, 78, -127, 18, -88, 48, -108,
            56, 113, 80, 121, -108, -100, 31, -81, -108, 33, -121, 108, 22, -90, -37, -101, 39, 1, -69, 95, 67, -41,
            -124, -100, -29, -116, -1, 6, -61, 29, 127, 37, -9, 33, 62, -74, -17, 73, 64, 77, 66, 8, -98, -43, 25, 97,
            -100, -89, 42, -18, 101, -73, -70, -80, 46, 45, 113, -41, 111, -21, 33, 42, 52, 27, 108, 14, 51, -3, -124,
            -128, -56, -60, -55, 68, -9, -85, 36, -18, 16, 106, 2, -122, -34, -115, 106, 39, -37, -75, -64, 57, -4, 31,
            70, 105, 24, -4, 7, 52, 119, -112, -5, -110, 105, 39, 44, 13, -102, -80, 69, -5, 52, -46, 83, 2, -48, 93,
            -18, -124, 103, 77, 26, 24, 126, -84, -128, -47, 102, 37, -118, 26, 105, 87, -102, -126, 26, -31, -85, -62,
            -3, -92, 21, 18, 89, -81, 16, 19, -13, -116, -126, -62, 57, -35, 8, -115, -23, 6, 43, -82, -105, -94, -34,
            49, 82, 81, -12, -107, 51, -49, 33, 6, 29, -121, 34, 104, -65, 5, -43, 113, -71, 2, 121, 87, -97, -112,
            -117, -81, -91, 47, 97, -104, -12, 118, -75, -109, -99, 46, 28, 110, -73, 78, -96, -78, 98, 39, -98, 63,
            -75, -125, -96, 101, 19, -6, 26, -42, -29, 113, -31, 60, 12, 63, 82, -58, 120, -109, 18, -58, -8, 27, -56,
            -6, 89, -113, -105, 61, 100, 42, 118, 107, 82, -44, 115, -126, 42, 105, 56, -114, -60, -72, 124, -60, -58,
            118, 33, 58, -95, -113, 28, 106, -69, 8, -86, 11, -31, 4, -59, 78, -24, 7, 39, -66, -113, -106, -101, -14,
            19, 114, 47, 75, -96, 26, 109, 35, -24, -5, 115, -66, 35, -39, -70, 15, 70, -48, 100, -95, 90, 79, 113, 80,
            -26, -32, 47, 19, 85, -22, 66, 14, -68, -105, 31, -93, -27, 10, 89, 87, 103, 2, -31, 113, -27, 14, -50,
            -100, -68, -118, -28, -120, -77, -24, -86, -38, -115, -95, -10, 77, 24, -19, 80, -59, 96, -13, 122, 114, 47,
            -38, -128, -8, 27, -53, -95, -8, -69, 57, -8, 97, -31, 28, -100, -33, -68, 2, 87, 108, -28, -16, -29, -23,
            47, 81, 87, 98, -116, -95, 46, 117, -116, -11, -85, 97, -92, 95, 23, -115, -125, -50, -16, 14, 56, -121, 68,
            -18, 51, 4, 71, -14, 112, -37, -65, -106, 126, 13, -115, -30, 19, -96, 0, 113, -15, 61, -76, -100, -8, 113,
            -124, -37, -26, -125, -85, -16, 30, -108, -88, -39, -116, 84, -82, 45, 11, -113, 47, -36, 71, -59, -7, -45,
            120, -99, -23, -116, 63, -41, -83, -58, -37, 38, 121, -4, -44, -70, 14, -61, -99, -85, 49, -36, 37, 71, 81,
            76, 99, -19, -54, -8, -71, 123, 53, 70, 30, 109, 70, -25, 125, 77, 36, 59, -39, 35, -23, 10, 11, -15, 81,
            -11, -28, -30, -101, -111, -110, 24, -127, 4, 110, 32, 56, 17, 126, -32, -60, 100, 33, -118, 93, -126, 72,
            86, 3, -4, 67, 27, 105, 12, 74, -108, 8, -107, 20, -2, 4, -73, -116, 98, 39, 81, 117, -106, 33, 19, -65,
            -66, -31, 76, 89, 83, -94, -38, -100, 89, 82, 35, 37, -38, 5, -53, -99, -61, 80, 115, 48, 18, 49, 58, 87,
            -48, -30, -51, 66, 27, -37, 8, -93, 85, 107, 48, -36, 40, -121, -15, 54, 37, -116, -74, -81, 39, -45, 74,
            94, -104, 104, -51, -112, -23, 53, -14, 104, 49, 94, 60, 52, 6, 107, -43, 29, -4, -88, -28, -115, -124, 99,
            -27, 116, -67, 48, -21, 35, -116, 43, 92, 55, 76, -111, 73, -67, 8, -115, 21, -48, 24, 4, 51, 58, -78, 80,
            37, 126, 79, 17, -96, -53, 5, 119, 61, 123, 18, -59, 115, -32, -128, -25, 24, 13, -2, -95, 112, -103, -88,
            14, -73, 72, 52, 31, -113, 18, -93, 10, 29, -123, -93, -11, -128, -36, -73, 106, -19, -82, -125, -85, -69,
            29, -119, 71, -76, 49, -100, -73, 17, 99, -75, -53, -16, -100, -116, -110, 44, -44, 120, -105, 26, 73, 3,
            -115, 113, 91, 80, -18, 125, 14, -31, -85, -67, 113, 83, -59, 23, 92, -73, 98, -80, -94, -69, 16, 21, -41,
            63, 5, 21, -98, -48, -115, 16, 114, -102, 96, 98, -90, 28, -117, 67, 62, -77, -37, 104, -52, -9, 34, 84,
            -31, -99, 1, -8, -21, 76, 67, 49, 83, -80, -47, 46, 28, -51, 54, -63, 50, 81, 76, -75, -50, -63, 82, 107,
            -86, -36, 37, 8, 9, -6, 91, -111, 103, -73, 0, 1, 54, 115, -16, -86, 98, 3, 94, -43, -83, -91, 32, 89, 40,
            26, -71, 39, 61, 98, -99, -63, -117, -108, 17, 68, 125, -17, -113, 59, 26, -127, -72, -67, 39, 6, -63, 17,
            -19, 116, -76, 36, 81, -127, 81, 60, 113, -47, 9, -67, -30, -47, -118, -92, 27, 71, -81, 24, -107, 74, 54,
            9, 31, -51, -88, -103, 81, 20, 38, 99, -6, -119, 80, 37, 7, 125, 80, 74, 96, 76, 37, -50, 62, 72, 49, -33,
            -114, -68, 109, -97, 34, 76, 105, 14, -18, 95, -4, 2, -49, -86, 85, -16, -92, 117, 5, 70, 4, 107, -56, 86,
            77, 118, 55, 30, -103, 118, 60, 69, -68, 106, -109, -57, -97, 91, -11, 81, -53, -42, 71, 71, 116, 28, 6,
            -93, -5, 80, 110, 95, -115, 64, -107, 80, -36, -111, -9, 71, -38, -43, 22, -92, 68, 60, 33, -88, 94, 33,
            -120, -35, 46, 70, 48, 49, -21, -119, -7, 42, -66, 9, -109, 82, 56, -3, -88, 33, -113, 37, -63, 91, 99, 16,
            -82, -52, 2, 75, 62, 120, 102, 84, -77, 109, 32, 120, -10, 66, -100, 104, -92, 26, -35, 35, 81, 104, -29,
            53, 13, -27, -117, 66, -121, 125, -28, -97, 93, 9, -127, -59, 71, -88, -78, -7, 61, 30, -100, 93, -122, 26,
            -97, 5, 120, 91, -90, -121, 113, 114, -36, 25, 105, 86, -64, -109, -121, 43, -15, 115, -121, 10, -58, -22,
            -12, 16, 115, 97, 49, -98, -35, -53, 70, 123, 80, 43, 94, 6, -4, 12, 95, -59, 32, -118, 58, -79, 37, 4, 28,
            127, -127, 24, 69, -89, -33, 4, 72, 50, 6, -61, -114, -19, -93, -93, 26, -49, -18, 65, -98, 79, 7, 124, -75,
            -61, -55, 3, 98, 8, -82, 124, 117, 97, 42, -86, -55, 54, 28, -83, -42, -63, -76, 38, -69, 64, -76, 30, 10,
            6, -33, 105, 18, -59, 108, 20, 12, -120, -87, -56, 33, 8, -123, 46, 55, -56, -77, -44, 105, -60, 59, -88,
            -31, -89, 88, 3, -76, -20, -6, 24, 13, -26, -97, -93, -48, -8, 83, -44, -103, 125, -118, -62, 109, 115,
            -112, 97, -11, 59, -92, 57, -50, 65, -77, -41, -105, 72, 119, -102, -125, -124, 3, 31, -111, -121, -54, -81,
            17, -96, -81, -114, -58, -101, -9, -48, -26, 89, -123, -117, 107, -50, -62, 83, -63, 23, -114, 114, -73, 16,
            -31, -55, 39, 107, -91, 11, 33, 81, -99, 116, 26, -122, 68, 119, 32, 44, -90, 19, 44, 110, -89, 24, 21, -61,
            -23, 3, 55, -70, 7, -47, 81, -35, -32, -124, 15, -32, -78, 102, 48, 124, -27, 3, 17, -88, -32, -113, -21,
            107, -81, 72, -93, -8, 86, -63, -76, -58, -125, 65, 104, 113, 8, 17, -125, -104, -38, -49, -59, -117, -89,
            95, 46, 1, -25, -72, -98, 65, -114, -69, 21, 70, 75, -9, -30, -49, -11, 58, -8, -65, 21, -122, -92, 29, 40,
            62, 50, 7, 117, 86, 31, 35, -25, -121, 57, -32, -101, -49, -127, -64, -28, 35, 116, 24, 127, -124, 103, -5,
            62, 65, -107, 26, -7, -34, -20, 15, -32, 24, -51, -61, 37, 125, 109, -124, -103, -97, 0, -33, -81, 30, -41,
            84, 125, 113, 109, 77, 16, 14, -83, -9, 5, -117, 37, 16, -81, 47, 102, 10, 10, 71, 109, 18, 21, 31, -47, 45,
            -18, -108, 62, 7, 126, -21, 66, 16, -66, -110, -84, 75, -91, 75, 40, 11, 72, -5, 48, -108, -28, -12, 43, 34,
            7, -39, 12, -57, 19, -56, 58, -78, 23, 99, 53, 90, 120, -45, -70, 10, 67, 2, 114, 99, 109, -109, -61, 0, -7,
            -4, -9, -90, -51, 120, -7, 96, 61, 74, 47, 124, -116, -38, 51, -97, -93, -56, -19, 99, 84, 29, -1, 6, -71,
            -10, -1, 11, -81, -72, -101, 113, -59, -28, 83, -60, -6, -99, 69, 103, 88, 14, 90, -68, -86, -111, 108, -99,
            7, -10, -118, 112, -4, -72, 62, 2, -58, 59, -68, 113, -19, 86, -27, 59, 81, -55, -47, -3, 56, -80, 39, 8,
            -111, -21, 34, 104, 92, -7, 72, -36, 119, -56, 68, 107, 108, -71, 16, 85, 109, 25, -118, 122, -37, 72, 52,
            -40, -66, 123, 77, 85, 58, -8, -111, -57, -7, 91, 4, 117, -101, 92, 92, 40, -54, -50, 57, 99, 60, -33, 110,
            -14, -98, 36, 80, 16, -57, -20, 118, 47, 123, -108, -90, 70, -18, 81, 116, -9, -29, -85, 35, -31, 38, 57,
            85, -100, 59, -119, -74, -104, 74, -76, -109, 27, 110, 87, 66, 11, 34, -41, 114, 112, 119, 37, 27, -95, -33,
            5, -64, 115, -35, 117, 112, 46, 63, -64, -79, -21, -87, 48, -74, -9, -62, -39, -37, 57, 8, 11, -30, 33, -3,
            118, 27, 26, 93, 4, -72, -71, 44, 0, 126, 107, 89, -16, 91, 19, -127, -32, 13, -119, 8, -74, -70, -115, -50,
            -60, 58, -46, 67, 33, -22, -127, 121, -48, -84, 80, 53, -50, 100, 115, 56, 116, -121, -94, -78, 29, -81, 32,
            -64, 120, 17, -58, 75, -74, -30, 5, 111, -125, 20, 106, -68, 123, -125, 76, -108, -16, 62, -91, -122, -95,
            6, 115, -100, -37, -3, 61, 4, -119, 101, 20, -44, -105, -62, 71, 127, -32, 32, -50, -84, 61, 15, 127, -35,
            64, -104, 47, 112, -58, -26, -115, -25, 113, -32, 68, 4, -10, 29, 15, -127, -111, -35, 29, 56, -110, 51,
            -86, -67, -26, 117, 4, -54, 69, -46, 66, 55, 112, -31, -93, -24, -125, 96, -19, 16, -76, 71, -43, -48, 127,
            65, 98, 84, -71, 89, -32, -84, 80, -75, -28, -98, 84, -26, -32, 77, 81, 25, -28, 104, -109, 119, 97, 45, -2,
            75, 96, 56, 121, 79, -110, 64, 73, -127, 38, 80, 52, 114, 104, 29, -31, 109, -122, -81, -37, 106, -92, 92,
            -12, -62, -67, -13, 28, 100, 94, 74, 4, -105, 60, -124, 102, -3, -104, -125, -101, 102, -66, -16, 114, 75,
            -57, 9, -97, 82, 88, 28, 11, -59, 73, -17, 76, -100, -9, -51, -61, -27, -77, 89, -72, 96, 19, 69, 71, -24,
            -57, -91, -2, -72, -12, -11, 77, -36, 119, -118, -61, 88, 112, 11, -70, -94, -86, -47, 73, -22, -117, -83,
            -1, 64, -108, -85, 47, -54, -100, 60, 81, 114, -24, 26, -30, 14, 111, -57, -56, 125, 99, 60, 127, -72, 88,
            -26, -12, -109, 2, -111, -58, -6, 20, 39, -110, -61, 88, -113, 22, -54, 18, 55, -61, 114, -117, 26, -84,
            -11, 76, 96, -83, -29, 6, 71, 45, 39, 120, -20, -11, -64, 97, 115, 79, 56, 91, -4, 8, -5, 61, 30, 112, 59,
            -26, -121, 3, 7, 61, 96, 107, 123, 29, 39, 109, -3, 96, -73, -13, 18, 124, -115, 111, 32, 116, -37, 21, 112,
            77, 110, -29, -82, -63, 21, -60, -17, -9, 71, -23, -119, 56, -36, -97, 72, -116, 98, -42, 85, -115, -27, 4,
            104, 22, 40, -17, -67, -28, 66, 43, -10, 98, -4, -15, -118, 89, -113, -44, 116, -44, -117, -74, -93, -72,
            -75, 99, 59, -94, -83, 47, 32, -36, -108, 28, 94, -115, 111, -47, -62, -116, 124, 16, 98, -28, 75, -29, -18,
            -11, -101, 40, 0, -111, -122, -66, -120, -37, 29, 2, -10, -50, -101, 96, -17, -72, -127, 112, 125, 15, -80,
            118, -34, -96, 69, -102, 120, -110, -82, 35, -107, 92, 55, 69, 85, -102, 7, -32, -95, 85, 8, -39, -122,
            -125, -47, 64, -44, 51, -95, -22, 93, -125, -111, 119, -24, 18, 89, 79, 7, 81, 26, 68, 30, 15, 30, -22,
            -111, 71, -15, -107, 120, -38, 68, 78, -32, 124, -26, 8, -76, 65, -36, 51, -34, 90, -116, 117, 42, -32, 69,
            -113, -86, -72, 39, -99, -54, 36, 37, -6, -11, 103, -14, -11, 101, -85, 10, -110, -50, -20, 68, -31, 33, 15,
            60, -36, -109, -115, 90, -21, 4, 60, 62, 116, 15, -91, -90, -28, -32, -68, -121, 75, -53, -36, 28, -128, 7,
            123, 56, 40, 39, 63, 123, 96, -103, -124, 26, -101, 123, 72, 53, -12, 71, 6, -63, -27, 91, -80, -111, -71,
            -99, 92, -13, -95, 116, -28, 25, -77, 104, 119, -27, -49, 9, 81, 85, 102, 1, 96, -74, -11, -9, -94, 92, 66,
            9, -22, 34, -78, -100, 45, 113, 63, 100, 13, 57, 29, 104, 82, -44, 96, -77, -36, -28, -71, 110, -94, -34,
            71, -53, -23, 14, 56, -42, -93, 46, -18, 73, -89, 26, -6, -69, 84, 72, -54, 120, -34, -85, -115, 39, 2, 13,
            -12, 60, 58, 11, 39, -71, -43, -72, -75, -30, 40, -126, -106, 123, 34, 108, -75, 23, -4, -105, -4, 8, -1,
            -59, -73, 104, -34, 11, 110, -48, -81, 126, 75, -56, -9, 107, -56, 86, -65, -32, 50, -82, 47, 60, -113,
            -101, 75, 46, -61, 107, -59, 53, 4, 44, -71, -115, -80, 85, -2, 8, 93, -23, 71, 99, 62, 83, -44, 108, -113,
            73, 34, 84, -2, 17, 91, 60, 43, -35, 37, 68, 53, -83, -112, 2, 49, -43, 21, 124, 54, 5, 53, -44, -95, -124,
            103, 125, 90, 24, 30, -36, -120, -68, -116, 37, -72, -61, -102, 11, -65, -104, 111, -64, 45, 84, 7, -5, -50,
            62, -100, -41, -75, 66, -48, -94, -104, -119, -30, 16, -12, 109, -68, -72, -80, 101, 41, 8, 89, -98, 2, -97,
            37, -15, 52, -81, 69, 108, 4, -82, 36, -97, -105, 114, -90, -4, 61, -94, 40, -22, 125, -9, 41, 30, 121, -68,
            96, -86, 60, 28, 66, 78, 11, -18, -120, -76, 88, 65, -50, 114, -21, -24, -5, -123, -95, -58, -55, 83, 56,
            115, -31, -94, 58, 30, -83, -59, 112, -73, 10, 106, 123, 76, -31, -18, -5, 57, -62, 10, -75, -112, -44, 108,
            -114, -116, 14, -21, -119, 14, -46, -46, -101, -19, -59, 93, -7, 97, 59, 60, 23, 122, 32, 104, 73, 40, -18,
            46, 13, 64, -32, 124, 111, -124, 124, -105, 78, 70, 32, 3, 97, 43, -45, 16, -70, 52, -118, -116, 98, 20,
            -126, -26, 115, 17, -79, 52, 25, 33, 11, -29, 16, -70, 48, -103, 22, -71, 60, -111, 20, -117, -48, 69, 81,
            51, -93, 36, 79, -23, 34, -44, 67, 114, -49, -56, 115, 118, 65, -56, -18, -123, 20, 52, 19, -86, -90, -32,
            43, -100, -65, -11, 123, 84, -15, -74, -95, -88, 109, 55, 10, -38, 45, -112, -33, -79, 95, 2, 52, -119, -54,
            110, 115, 18, 87, -102, -22, 9, -13, 47, -73, -29, -6, 18, 47, 28, 91, 115, 7, 1, 39, 106, 112, -61, -69, 5,
            87, 111, 61, -58, -11, 31, -101, 16, 127, -84, 29, -105, -42, -122, -61, -1, 79, 81, 8, 94, 16, 75, 97, 34,
            84, 40, 25, 97, 6, -60, -64, 102, -119, 10, -90, -43, -97, -118, 66, -74, -125, 3, -18, -102, 124, 37, -127,
            -102, 120, 86, 34, 13, 119, 40, -110, -93, -110, 10, 42, 11, -25, 35, -77, -43, 28, 57, 29, 86, -56, 37,
            -96, -126, -10, 125, -56, -101, -126, -78, 17, -93, -78, -38, 28, 9, 72, 88, -93, 32, 0, -37, -66, 85, -61,
            -91, 21, -98, -80, 82, -10, -62, 33, 114, 124, 58, 21, 90, -116, -45, 97, 37, 56, 21, 86, -114, -13, 126,
            -35, 112, 85, 14, -123, -33, -68, 73, 20, 107, 65, 34, 45, 116, 17, -9, -3, 40, 89, 107, -86, -31, 4, 7,
            -39, 78, 7, -112, 114, 100, -98, -8, -34, -12, -126, -81, 40, 70, -67, 106, 95, -122, 118, -98, 10, 18, -53,
            -108, -89, -115, -54, -44, -47, -103, -87, -102, -121, 94, -80, -98, -65, 9, 87, 87, 92, -122, -99, -46, 85,
            -100, -9, 40, -122, -53, -51, 28, 24, -71, -122, -30, 82, 120, 61, 124, 111, -74, -64, 85, -47, -105, 76,
            79, 14, 56, -33, -90, 32, -6, -21, 100, -8, 46, -119, -91, -99, 90, -56, -58, 49, -126, 58, -4, -51, -60,
            107, -25, -39, -94, 120, 23, -109, -111, 118, -48, 12, -75, 94, -21, 101, -94, 126, -30, -81, 64, 87, -69,
            6, -86, -70, 76, 100, -128, -34, -113, 42, 125, 112, 125, 10, -54, -45, -89, 22, 103, -125, 43, -124, -35,
            -83, 70, -128, 55, 31, 103, 53, -62, -80, 111, -82, 39, -55, 23, 7, -26, 5, 65, 101, 109, 58, 109, -115, 74,
            62, -66, 83, 43, -92, -51, 10, 37, 92, 83, -28, 57, -21, 98, 44, 65, -19, -58, 72, -86, -111, 76, -44, 72,
            -57, -9, -24, -20, 51, 64, 86, -53, 46, 9, -120, -99, -44, -59, 79, -119, -17, -122, 52, -98, 11, 82, 91,
            -100, 16, -32, -79, 27, 118, -97, -85, -29, -54, 60, 119, -100, 80, 32, 83, 112, -37, 29, -104, -70, -41,
            96, -71, 110, 48, -106, -23, 68, 97, -127, 114, 62, -106, -85, -107, 96, -87, -6, 125, 44, -47, 40, -59, 98,
            -46, 34, -115, 7, -76, 37, 26, 69, 88, -86, -103, -113, -123, 42, 89, 31, -126, -70, 59, -127, 50, 33, -88,
            29, 51, -96, -28, 32, -112, 66, -55, -128, 76, 65, 29, 38, 40, 87, -126, 114, -122, -63, 6, 69, 108, -101,
            103, -118, 93, 115, -49, -29, -121, 5, 55, -95, -89, -59, -62, 98, -43, 36, 44, -41, -68, 71, 46, 56, 11,
            -13, -107, 75, -60, -120, -23, 45, 37, -88, -27, 26, 121, 88, -92, -100, -7, -95, 40, 46, -46, -20, 77, 48,
            -100, 108, 48, 35, -86, -68, 70, 1, -87, 13, -122, 31, -124, 98, 64, 9, -113, -20, 33, -65, -54, 12, -85,
            -75, 89, 88, -93, 90, -124, 117, 27, 42, -15, 71, -99, 74, 44, 85, -83, -93, 45, 81, 123, 40, 5, -111, 108,
            -95, 114, 46, 5, 109, -34, -57, -97, 29, 74, -76, -90, 90, 46, 113, -112, -30, 96, -124, -95, -76, -83, 50,
            81, 67, -28, -52, -105, 94, -68, 26, -39, 100, -73, -101, 45, -22, 30, -49, 10, -87, -11, 94, 80, -33, 101,
            -123, -91, -38, 113, 88, -86, 86, -123, 69, -118, 101, 88, -76, -95, -124, -10, -115, 74, -95, 84, -117, 53,
            75, -15, -83, -6, -44, 63, 91, -77, -87, 20, 43, 116, -14, -96, 107, -47, 60, 51, 74, 114, 75, -97, -114,
            -22, 75, -40, 40, 19, 53, -38, -85, 2, 86, -36, -105, -56, -17, -98, -3, -26, 16, 87, 103, -125, -128, 100,
            63, 40, 25, -100, -58, 66, -75, 104, -118, 90, -82, 74, 82, 123, 64, 99, 0, -110, -119, 16, 11, -43, -118,
            -89, 124, -1, -39, -86, 24, -4, 96, -35, -2, 110, 84, 27, -63, -16, 39, -110, 68, 37, 59, -20, -60, 64, 34,
            57, -56, 62, -106, -61, 75, 30, 115, 58, -105, -104, 126, -67, 106, 8, -117, -3, 10, -71, 93, 12, -58, 118,
            34, 105, -120, 100, -7, -99, 87, -95, 101, -76, 21, -118, -38, 63, 98, -95, 106, 34, 65, 85, 80, -40, 82,
            -75, 74, -6, 121, -79, 102, -39, 68, 4, -91, 69, 70, 71, 53, 127, 70, -44, 54, -85, 14, -24, -103, -73, -52,
            -116, -110, -11, -114, -30, -15, -103, 40, 36, 91, 27, -47, -35, 111, -20, -111, 28, 94, -73, 42, -47, -9,
            121, 34, -44, -13, 62, 109, 4, 114, -25, 35, -83, -3, -128, -44, -59, 79, 47, -101, 47, -84, 64, 96, 9, 43,
            -105, -3, 80, 86, -16, -63, 66, -91, 2, -31, -50, -90, 94, -119, 69, -22, 85, -62, -60, -21, -26, 62, 22,
            105, -27, 97, -66, 106, -26, 20, -108, -88, 47, -55, 77, 119, -53, -98, 86, -4, 96, -54, -101, 124, -98,
            -102, -114, -110, -60, -120, 106, -67, 24, 67, 55, -118, -74, 16, 85, -103, -88, 30, -14, -39, 59, -30,
            -101, 89, -95, -46, 91, -84, 105, 119, 82, -27, 113, -6, -38, 9, 104, -86, 5, -67, 23, -75, 92, -81, 120,
            70, -44, -65, 44, -120, -128, -98, 113, -45, 36, -86, -38, 50, 2, -52, 47, -34, -104, -33, 83, -47, -45, 58,
            -13, 91, 16, 25, -88, 74, 23, 54, -18, -69, 31, 69, -91, -89, -118, 108, 20, 121, 62, -70, 27, -65, 10,
            -119, -115, -52, -111, 72, 26, -110, -42, 102, 71, 75, 111, -77, -90, -25, -63, 34, -63, 126, -16, 31, -20,
            64, 78, -10, 97, -88, 107, 121, -109, -75, -60, -63, 106, -107, 106, -78, -37, 61, -108, -127, -102, -104,
            -126, -92, 63, -86, 21, 96, 30, -39, -62, -65, -47, -66, 47, -18, -9, 11, 103, -127, 106, 117, 12, 5, 79,
            -30, 69, 38, 83, -103, 99, 56, -118, -113, 30, 70, -31, -7, -75, -17, 69, -91, -15, 109, 105, 98, 16, -13,
            -3, 52, 84, 94, -101, 25, 58, 30, 42, -93, -123, 127, 2, -14, 42, 46, -65, 25, -11, -75, 102, -15, -20, 80,
            -78, -42, 84, -79, 93, 48, 10, 15, -69, 34, -47, -27, -101, -9, -94, 82, 121, -42, 52, 17, -118, -7, 60, 29,
            -107, -47, 104, -116, -50, -90, 111, 81, -33, 106, 2, -75, 45, 22, -65, 25, -59, 124, 63, 35, -86, -127,
            -84, -85, 119, 109, 20, -52, 127, 24, 82, -32, -22, -114, 32, -29, 111, 49, 84, -77, 14, -81, 91, 84, -15,
            19, -127, -120, -34, 81, 12, -112, 115, 31, 43, 121, -91, 76, -108, 8, 38, -4, 108, 75, -18, 101, -42, 72,
            105, 52, 67, 81, -123, 34, -38, 122, -116, 96, -66, 115, 41, -106, -85, 7, 98, -107, 90, 14, 65, -43, 99,
            -111, 90, 3, -106, 107, 55, 79, -30, -56, 58, 19, -95, 100, -83, -87, 79, -65, -117, -59, 70, -77, 86, -78,
            -5, -3, 70, 84, -84, -83, 28, 69, -115, 53, 40, 96, -12, -47, 122, 49, -86, -105, -89, 10, 110, -26, -102,
            41, 40, -39, 89, 81, 84, 122, -21, 126, 100, -26, -82, 70, 5, -103, -126, 17, -127, 78, 82, 40, -38, 44, 81,
            -13, 21, -45, -95, 99, -38, 44, 3, 101, -61, 76, 63, 22, -83, -107, 57, 30, 57, -123, 19, 12, 89, 95, -50,
            97, 52, -26, 23, 108, -59, 110, -25, -112, -18, -92, -113, -89, -27, -38, 100, 10, 110, -64, -24, -29, 53,
            98, -44, 80, 39, 25, -87, -124, -7, 72, 109, 126, 31, -118, -103, -118, 7, -24, 105, 34, -69, 109, 39, 42,
            -101, 118, -127, 87, 99, -121, -11, -54, 71, -80, 74, -91, -108, -20, 126, 85, -28, 88, 84, 73, 91, 76, -90,
            30, 77, -77, 92, 12, 96, 78, 19, -52, 110, -56, 124, 94, -90, 35, -68, 65, 127, -85, -104, 2, 77, -93, 106,
            -24, -102, 76, -68, -52, -108, -75, -90, -104, -1, -45, 77, 84, 51, 1, 49, 85, -70, -122, -96, -60, -19, 10,
            114, 92, 44, 48, 88, -94, -113, -79, -57, 74, 24, 109, -108, 120, 69, -42, -83, -119, 16, -50, 92, -78, 85,
            -65, 31, 37, -82, 125, 23, 82, -117, -75, -47, 81, -67, 7, 10, -14, 58, 116, -92, -106, 104, 8, 79, -30, 76,
            -110, -93, 33, -85, 21, 27, -123, 35, -72, 72, 49, 9, 42, 91, -117, -79, 92, 37, -15, -73, -93, -8, 89, 26,
            100, -92, -90, -94, -6, 91, 20, 16, -97, -15, 29, 82, 27, -51, -91, 47, -98, 39, -67, -66, -124, 40, 99,
            100, -106, 111, 66, 83, -23, 118, -104, -104, 110, -62, 50, 117, 127, 44, 80, -55, -96, -9, -84, 121, -14,
            -39, 116, -86, -3, 81, 33, -121, 38, 121, -42, -101, -34, -126, -11, 113, -48, -34, 89, -122, -83, 102, 19,
            111, 104, 101, -95, 26, -19, 66, -48, 114, -120, 53, 5, 85, -30, 120, 19, 15, -114, 123, -93, -64, -7, 58,
            -94, 78, -84, 36, 40, 114, -34, 107, 80, 22, -97, 3, 71, 58, 20, 80, 66, 22, 126, -95, -32, 0, 82, 91, -19,
            38, -78, -103, 68, -75, 59, 72, -4, 92, 88, 118, -85, 37, -118, -38, 108, -32, -51, -111, 67, 110, -127, 39,
            -42, -53, -97, -58, -9, -21, 34, 104, -21, -42, -122, 67, 78, -77, -128, -20, -120, -39, 88, -95, 90, -120,
            47, 84, -22, -15, 39, -51, 38, -14, -120, -111, 77, -42, 93, 6, 57, -107, -89, 97, -123, 90, 17, -26, 127,
            -97, -114, 21, 107, 47, -30, 123, -71, -93, -40, -88, 123, -5, -73, -93, -68, -83, 23, 96, -92, 126, 45,
            -98, -41, 77, 69, 61, 106, -35, -124, -88, -46, 77, 50, 81, -45, 65, 76, -103, -28, -49, 115, -102, 109, 16,
            95, -74, 11, -29, -71, -90, -16, -8, 118, 33, 98, 23, 26, 34, -23, 27, 3, 36, -110, -4, 87, -104, -45, 60,
            87, 29, -124, -2, -78, -109, -48, -7, -38, 5, -85, -65, -67, -115, -43, 11, -123, 45, -34, -62, -62, -36,
            13, 55, -16, -61, -82, -117, 48, -36, 121, 28, -122, -69, -114, 124, 56, -86, 124, 2, 21, -30, -68, 10, 67,
            -75, 43, -15, -84, 90, 105, -14, 93, 58, 127, 61, 30, -13, -12, -64, -7, 0, 20, 3, -54, 109, -79, -91, 21,
            5, -21, 34, 124, -15, 39, -88, -4, 76, 3, 53, 127, -40, 72, 123, -4, -69, 93, -62, 62, -38, -127, -10, 47,
            13, -15, -24, -29, -115, -88, -6, 100, 19, -83, -102, 100, -74, -56, 10, -122, -33, 88, 98, -113, -95, 35,
            118, -20, -78, 38, 29, 124, 55, 74, 84, 51, -39, 1, -103, -78, -84, 3, 81, 112, -28, 22, -110, 28, 109, 80,
            28, -79, 3, -126, 10, 45, 116, 61, -100, -113, -31, -90, -107, 19, -83, 66, 87, -113, 62, -78, 26, 12, -92,
            46, -98, 73, -14, 29, -97, -84, -30, 2, 55, 32, 81, 107, 9, -54, -26, 42, -94, -14, 115, 53, 97, -97, -22,
            -46, 42, 62, -45, 69, -23, 103, -101, -124, 125, -66, 85, -36, -115, -71, -101, 96, -91, 107, 2, 125, 19,
            50, -110, -58, 14, 52, -118, 42, 55, 11, -103, 21, -86, -104, -116, 90, -23, 73, 63, -124, -103, -17, 66,
            107, -10, 33, -44, 102, -84, -63, -45, -42, 101, 83, 80, -83, 109, 27, -55, 84, -46, -90, -120, -124, -57,
            86, 31, -124, -54, 40, 55, -59, 64, -104, 59, -14, -66, -112, 67, -39, 39, 74, 51, -94, -118, 62, -103, 44,
            -30, -117, 109, 56, -86, 100, -116, -19, -6, -106, -48, -41, -73, -58, -50, -99, -121, -124, -88, 82, -117,
            80, 84, -39, -80, 81, 101, 21, -119, 90, 43, 22, -71, 9, -77, -47, 64, -114, 68, -30, -20, 67, 104, 85, 46,
            17, -72, -25, 116, 9, -89, 13, 84, 80, -100, -78, 15, -20, -80, -49, -48, -39, 42, -121, -89, 13, -101, 73,
            91, -48, -43, -66, 28, 77, -113, 21, -111, 113, 79, 9, -9, -22, -83, 104, -55, 13, -74, -92, -125, 72, 34,
            101, 55, 57, -117, 99, 126, -58, -108, -34, -20, 36, 46, -86, -15, 8, 10, 2, 76, 17, -10, 47, 11, 80, -9,
            -107, 54, 4, 31, -87, -93, 120, -82, 14, 74, -66, -44, -59, 125, 82, -23, 23, -70, 40, -6, -125, -26, 20,
            84, -23, 103, -122, -56, -4, 124, 27, 82, -26, 78, 70, 81, -59, -5, 66, 81, 110, 29, -119, -54, 3, -111, 16,
            79, -59, -125, -63, 82, 61, 114, 101, 33, -50, -34, 29, 86, 91, -106, -95, 36, -59, 2, 81, 33, 95, -95,
            -125, -65, 28, -125, -4, -71, -92, 47, -48, 33, 88, -122, -66, -50, -51, 8, -11, 93, -128, -76, 58, 43, 90,
            74, -67, 29, -110, -21, -19, 105, 57, -115, 46, -76, -20, 38, 23, -15, -49, -46, 9, 80, 84, 74, -19, 113,
            -44, 102, 31, -63, -43, 47, -26, -95, 96, -95, 22, 26, 62, 81, 35, 32, 61, 2, -45, -91, -55, 66, 21, 127,
            97, -120, -4, 63, 108, 37, 109, 33, 109, -94, 9, -41, -108, 61, 23, 76, -11, -121, 98, -47, -28, 16, 79, 81,
            77, -28, 52, 49, -67, -127, -85, 105, 72, 115, 61, -113, 11, 54, 27, 113, 63, -51, 18, 1, -34, -97, -96,
            -91, 121, 1, -70, 107, -56, -55, -126, -81, 11, 94, -5, 50, 8, 4, -22, -16, -71, -7, 57, 114, -102, 14, -46,
            50, -55, 8, 100, 52, -69, -48, -118, -38, -36, 105, -123, 124, 119, -28, -14, -113, 74, -11, -96, -20, 52,
            74, 74, -35, -79, -9, -69, 121, 56, 60, 111, 49, 124, -66, 90, -115, -108, -113, -27, -111, -1, -103, 38,
            -115, 1, -27, 126, -84, -126, -36, -113, -76, -111, -1, 123, 93, -118, -54, -6, 88, 111, 34, 93, -110, 54,
            -115, 49, -3, 63, 48, -100, -4, 122, -65, 37, 66, -57, 0, 0, 0, 0, 73, 69, 78, 68, -82, 66, 96, -126};

        /**
         * {@inheritDoc}
         */
        @Override
        public ImageDimension getDimension(final DataValue value) {
            final var dim = getRendererComponent(value, m_renderer).getPreferredSize();
            return new ImageDimension((int)dim.getWidth(), (int)dim.getHeight());
        }

        private static Component getRendererComponent(final DataValue val,
            final org.knime.core.data.renderer.DataValueRenderer renderer) {
            if (renderer instanceof AbstractPainterDataValueRenderer) {
                return renderer.getRendererComponent(val);
            } else if (renderer instanceof DefaultDataValueRenderer) {
                var defaultRenderer = (DefaultDataValueRenderer)renderer;
                defaultRenderer.setValueCatchingException(val);
                return defaultRenderer;
            } else if (renderer instanceof ImageValueRenderer) {
                return renderer.getRendererComponent(val);
            } else {
                // should never happen
                throw new IllegalStateException("Unsupported renderer " + renderer.getClass().getName());
            }
        }

        @Override
        public String getId() {
            return m_id;
        }

    }

    private static DataValueRenderer createHtmlRenderer(final ValueFormatHandler formatHandler) {
        return new DataValueTextRenderer() {

            @Override
            public DataCellContentType getContentType() {
                return DataCellContentType.HTML;
            }

            @Override
            public String renderText(final DataValue value) {
                return formatHandler.get(value);
            }
        };
    }

}
